import{__awaiter as i}from"../../../node_modules/tslib/tslib.es6.js";import{jsx as e,jsxs as t}from"react/jsx-runtime";import r from"qrcode";import*as o from"react";import{Logger as s,Auth as p}from"aws-amplify";import{getActorState as m,translate as l}from"@aws-amplify/ui";import"../../AmplifyProvider/AmplifyContext.js";import"../Authenticator.js";import a from"../hooks/useFormHandlers/useFormHandlers.js";import{useAuthenticator as n}from"../hooks/useAuthenticator/index.js";import{useCustomComponents as d}from"../hooks/useCustomComponents/index.js";import"../../../primitives/Alert/Alert.js";import"../../../primitives/Badge/Badge.js";import"../../../primitives/Button/Button.js";import"../../../primitives/ButtonGroup/ButtonGroup.js";import"../../../primitives/Card/Card.js";import"../../../primitives/CheckboxField/CheckboxField.js";import"../../../primitives/Collection/Collection.js";import"../../../primitives/Divider/Divider.js";import"../../../primitives/Expander/Expander.js";import"../../../primitives/Expander/ExpanderItem.js";import"../../../primitives/FieldGroupIcon/FieldGroupIcon.js";import"../../../primitives/FieldGroupIcon/FieldGroupIconButton.js";import{Flex as v}from"../../../primitives/Flex/Flex.js";import"../../../primitives/Grid/Grid.js";import{Heading as u}from"../../../primitives/Heading/Heading.js";import"../../../primitives/Icon/Icon.js";import"classnames";import"../../../primitives/shared/constants.js";import"../../../primitives/View/View.js";import"../../../primitives/Image/Image.js";import"../../../primitives/Link/Link.js";import"../../../primitives/Loader/Loader.js";import"../../../primitives/Menu/Menu.js";import"../../../primitives/Menu/MenuButton.js";import"../../../primitives/Menu/MenuItem.js";import"../../../primitives/Pagination/Pagination.js";import"../../../primitives/PasswordField/PasswordField.js";import"../../../primitives/PhoneNumberField/PhoneNumberField.js";import"../../../primitives/Placeholder/Placeholder.js";import"../../../primitives/Radio/Radio.js";import"../../../primitives/RadioGroupField/RadioGroupField.js";import"../../../primitives/Rating/Rating.js";import"../../../primitives/ScrollView/ScrollView.js";import"../../../primitives/SearchField/SearchField.js";import"../../../primitives/SelectField/SelectField.js";import"../../../primitives/SliderField/SliderField.js";import"../../../primitives/StepperField/StepperField.js";import"../../../primitives/SwitchField/SwitchField.js";import"../../../primitives/Table/Table.js";import"../../../primitives/Table/TableBody.js";import"../../../primitives/Table/TableCell.js";import"../../../primitives/Table/TableFoot.js";import"../../../primitives/Table/TableHead.js";import"../../../primitives/Table/TableRow.js";import"../../../primitives/Tabs/Tabs.js";import"../../../primitives/Text/Text.js";import"../../../primitives/TextAreaField/TextAreaField.js";import"../../../primitives/TextField/TextField.js";import"../../../primitives/ToggleButton/ToggleButton.js";import"../../../primitives/ToggleButtonGroup/ToggleButtonGroup.js";import"../../../primitives/VisuallyHidden/VisuallyHidden.js";import{ConfirmSignInFooter as c}from"../shared/ConfirmSignInFooter.js";import{RemoteErrorMessage as j}from"../shared/RemoteErrorMessage.js";import"../SignIn/SignIn.js";import"../SignUp/SignUp.js";import{FormFields as g}from"../shared/FormFields.js";const h=new s("SetupTOTP-logger"),F=()=>{var s,u;const{_state:f,isPending:T}=n(),{handleChange:b,handleSubmit:x}=a(),{components:{SetupTOTP:{Header:S=F.Header,Footer:y=F.Footer}}}=d(),[C,w]=o.useState(!0),[H,P]=o.useState(),[O,I]=o.useState("COPY"),[B,V]=o.useState(""),G=m(f),{user:M}=G.context,R=null===(u=null===(s=m(f).context)||void 0===s?void 0:s.formFields)||void 0===u?void 0:u.setupTOTP,A=null==R?void 0:R.QR;o.useEffect((()=>{M&&(e=>{i(void 0,void 0,void 0,(function*(){var i,t;try{const o=yield p.setupTOTP(e);V(o);const s=null!==(i=null==A?void 0:A.totpIssuer)&&void 0!==i?i:"AWSCognito",m=`otpauth://totp/${s}:${null!==(t=null==A?void 0:A.totpUsername)&&void 0!==t?t:e.username}?secret=${o}&issuer=${s}`,l=yield r.toDataURL(m);P(l)}catch(i){h.error(i)}finally{w(!1)}}))})(M)}),[M]);return e("form",Object.assign({"data-amplify-form":"","data-amplify-authenticator-setup-totp":"",method:"post",onChange:b,onSubmit:x},{children:t("fieldset",Object.assign({style:{display:"flex",flexDirection:"column"},className:"amplify-flex",disabled:T},{children:[e(S,{}),t(v,Object.assign({direction:"column"},{children:[C?t("p",{children:[l("Loading"),"â€¦"]}):e("img",{"data-amplify-qrcode":!0,src:H,alt:"qr code",width:"228",height:"228"}),t(v,Object.assign({"data-amplify-copy":!0},{children:[e("div",{children:B}),t(v,Object.assign({"data-amplify-copy-svg":!0,onClick:()=>{navigator.clipboard.writeText(B),I(l("COPIED"))}},{children:[e("div",Object.assign({"data-amplify-copy-tooltip":!0},{children:O})),e("svg",Object.assign({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},{children:e("path",{d:"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z"})}))]}))]})),e(g,{route:"setupTOTP"}),e(j,{})]})),e(c,{}),e(y,{})]}))}))};F.Header=()=>e(u,Object.assign({level:3},{children:l("Setup TOTP")})),F.Footer=()=>null;export{F as SetupTOTP};
//# sourceMappingURL=SetupTOTP.js.map
